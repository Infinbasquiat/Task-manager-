"""
Python Task Manager â€” GUI Edition
Requires: Python 3.7+  (tkinter is included in standard library)
Run: python task_manager_gui.py
"""

import json
import os
import tkinter as tk
from tkinter import ttk, messagebox, simpledialog
from datetime import datetime

# â”€â”€ Constants â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TASKS_FILE = "tasks.json"

COLORS = {
    "bg":           "#F0F2F5",
    "sidebar":      "#1E1E2E",
    "sidebar_text": "#CDD6F4",
    "accent":       "#89B4FA",
    "accent_dark":  "#1E66F5",
    "card":         "#FFFFFF",
    "header":       "#181825",
    "High":         "#F38BA8",
    "Medium":       "#FAB387",
    "Low":          "#A6E3A1",
    "done_fg":      "#9399B2",
    "row_even":     "#FFFFFF",
    "row_odd":      "#F7F8FC",
    "overdue":      "#FF6B6B",
    "border":       "#E0E3EB",
    "btn_green":    "#A6E3A1",
    "btn_red":      "#F38BA8",
    "btn_blue":     "#89B4FA",
    "btn_yellow":   "#F9E2AF",
    "text_dark":    "#1E1E2E",
}

PRIORITY_ICONS = {"High": "ğŸ”´", "Medium": "ğŸŸ¡", "Low": "ğŸŸ¢"}

# â”€â”€ Persistence â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def load_tasks():
    if os.path.exists(TASKS_FILE):
        with open(TASKS_FILE, "r") as f:
            return json.load(f)
    return []

def save_tasks(tasks):
    with open(TASKS_FILE, "w") as f:
        json.dump(tasks, f, indent=2)

def next_id(tasks):
    return max((t["id"] for t in tasks), default=0) + 1

# â”€â”€ Dialog: Add / Edit Task â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class TaskDialog(tk.Toplevel):
    def __init__(self, parent, task=None):
        super().__init__(parent)
        self.result = None
        self.task   = task
        title = "Edit Task" if task else "Add New Task"
        self.title(title)
        self.resizable(False, False)
        self.configure(bg=COLORS["bg"])
        self.grab_set()

        self._build()
        self._center(parent)

        if task:
            self._populate(task)

    def _build(self):
        pad = {"padx": 18, "pady": 6}

        # Title
        hdr = tk.Frame(self, bg=COLORS["header"])
        hdr.pack(fill="x")
        tk.Label(hdr, text="ğŸ“  Task Details", font=("Segoe UI", 14, "bold"),
                 bg=COLORS["header"], fg="white", pady=12).pack(anchor="w", padx=18)

        body = tk.Frame(self, bg=COLORS["bg"])
        body.pack(fill="both", expand=True, padx=18, pady=12)

        def lbl(text):
            tk.Label(body, text=text, bg=COLORS["bg"], fg=COLORS["text_dark"],
                     font=("Segoe UI", 10, "bold")).pack(anchor="w", **pad)

        # Task title
        lbl("Task Title *")
        self.title_var = tk.StringVar()
        title_entry = tk.Entry(body, textvariable=self.title_var,
                               font=("Segoe UI", 11), bd=0,
                               bg="white", fg=COLORS["text_dark"],
                               highlightthickness=1,
                               highlightbackground=COLORS["border"],
                               highlightcolor=COLORS["accent"])
        title_entry.pack(fill="x", padx=18, ipady=6)

        # Description
        lbl("Description")
        self.desc_text = tk.Text(body, height=3, font=("Segoe UI", 10),
                                 bg="white", fg=COLORS["text_dark"],
                                 bd=0, highlightthickness=1,
                                 highlightbackground=COLORS["border"],
                                 highlightcolor=COLORS["accent"])
        self.desc_text.pack(fill="x", padx=18)

        # Priority
        lbl("Priority")
        self.priority_var = tk.StringVar(value="Medium")
        pf = tk.Frame(body, bg=COLORS["bg"])
        pf.pack(anchor="w", padx=18, pady=4)
        for p in ("High", "Medium", "Low"):
            tk.Radiobutton(pf, text=f"{PRIORITY_ICONS[p]} {p}",
                           variable=self.priority_var, value=p,
                           bg=COLORS["bg"], fg=COLORS["text_dark"],
                           selectcolor=COLORS["bg"],
                           activebackground=COLORS["bg"],
                           font=("Segoe UI", 10)).pack(side="left", padx=10)

        # Due date
        lbl("Due Date (YYYY-MM-DD)")
        self.due_var = tk.StringVar()
        due_entry = tk.Entry(body, textvariable=self.due_var,
                             font=("Segoe UI", 11), bd=0,
                             bg="white", fg=COLORS["text_dark"],
                             highlightthickness=1,
                             highlightbackground=COLORS["border"],
                             highlightcolor=COLORS["accent"])
        due_entry.pack(fill="x", padx=18, ipady=6)

        # Buttons
        bf = tk.Frame(self, bg=COLORS["bg"])
        bf.pack(fill="x", padx=18, pady=(4, 18))

        def btn(parent, text, cmd, color):
            b = tk.Button(parent, text=text, command=cmd,
                          font=("Segoe UI", 10, "bold"),
                          bg=color, fg=COLORS["text_dark"],
                          relief="flat", bd=0, cursor="hand2",
                          padx=18, pady=6)
            b.pack(side="right", padx=4)
            return b

        btn(bf, "Cancel", self.destroy,  COLORS["btn_red"])
        btn(bf, "Save",   self._save,    COLORS["btn_green"])

        title_entry.focus_set()
        self.bind("<Return>", lambda e: self._save())
        self.bind("<Escape>", lambda e: self.destroy())

    def _populate(self, task):
        self.title_var.set(task["title"])
        self.desc_text.insert("1.0", task.get("description", ""))
        self.priority_var.set(task["priority"])
        self.due_var.set(task.get("due_date", ""))

    def _save(self):
        title = self.title_var.get().strip()
        if not title:
            messagebox.showwarning("Validation", "Task title is required.", parent=self)
            return

        due = self.due_var.get().strip()
        if due:
            try:
                datetime.strptime(due, "%Y-%m-%d")
            except ValueError:
                messagebox.showwarning("Validation", "Invalid date. Use YYYY-MM-DD.", parent=self)
                return

        self.result = {
            "title":       title,
            "description": self.desc_text.get("1.0", "end-1c").strip(),
            "priority":    self.priority_var.get(),
            "due_date":    due,
        }
        self.destroy()

    def _center(self, parent):
        self.update_idletasks()
        pw = parent.winfo_rootx() + parent.winfo_width()  // 2
        ph = parent.winfo_rooty() + parent.winfo_height() // 2
        w, h = self.winfo_width(), self.winfo_height()
        self.geometry(f"460x420+{pw - 230}+{ph - 210}")


# â”€â”€ Main App â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class TaskManagerApp(tk.Tk):
    def __init__(self):
        super().__init__()
        self.title("ğŸ—‚ï¸  Python Task Manager")
        self.geometry("1050x660")
        self.minsize(820, 500)
        self.configure(bg=COLORS["bg"])

        self._tasks  = load_tasks()
        self._filter = "All"
        self._search = tk.StringVar()
        self._search.trace_add("write", lambda *_: self._refresh())

        self._build_ui()
        self._refresh()

    # â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    def _build_ui(self):
        # Sidebar
        sidebar = tk.Frame(self, bg=COLORS["sidebar"], width=200)
        sidebar.pack(side="left", fill="y")
        sidebar.pack_propagate(False)
        self._build_sidebar(sidebar)

        # Main area
        main = tk.Frame(self, bg=COLORS["bg"])
        main.pack(side="left", fill="both", expand=True)
        self._build_main(main)

    def _build_sidebar(self, parent):
        # Logo
        tk.Label(parent, text="ğŸ—‚ï¸", font=("Segoe UI", 32),
                 bg=COLORS["sidebar"], fg=COLORS["accent"]).pack(pady=(24, 4))
        tk.Label(parent, text="Task Manager", font=("Segoe UI", 13, "bold"),
                 bg=COLORS["sidebar"], fg="white").pack(pady=(0, 30))

        # Filter buttons
        self._filter_btns = {}
        for label in ("All", "Pending", "Completed", "High", "Medium", "Low"):
            icon = {"All":"ğŸ“‹","Pending":"â³","Completed":"âœ…",
                    "High":"ğŸ”´","Medium":"ğŸŸ¡","Low":"ğŸŸ¢"}.get(label, "")
            b = tk.Button(parent, text=f"  {icon}  {label}",
                          font=("Segoe UI", 10),
                          bg=COLORS["sidebar"], fg=COLORS["sidebar_text"],
                          activebackground=COLORS["accent_dark"],
                          activeforeground="white",
                          relief="flat", bd=0, anchor="w",
                          cursor="hand2", padx=16, pady=9,
                          command=lambda l=label: self._set_filter(l))
            b.pack(fill="x", padx=8, pady=2)
            self._filter_btns[label] = b

        # Separator
        tk.Frame(parent, bg="#333355", height=1).pack(fill="x", padx=16, pady=16)

        # Stats panel
        self._stats_frame = tk.Frame(parent, bg=COLORS["sidebar"])
        self._stats_frame.pack(fill="x", padx=16)
        tk.Label(self._stats_frame, text="SUMMARY", font=("Segoe UI", 8, "bold"),
                 bg=COLORS["sidebar"], fg="#6C7086").pack(anchor="w", pady=(0, 6))

        self._stat_labels = {}
        for key in ("Total", "Pending", "Done", "Overdue"):
            row = tk.Frame(self._stats_frame, bg=COLORS["sidebar"])
            row.pack(fill="x", pady=2)
            tk.Label(row, text=key, font=("Segoe UI", 9),
                     bg=COLORS["sidebar"], fg=COLORS["sidebar_text"]).pack(side="left")
            val = tk.Label(row, text="0", font=("Segoe UI", 9, "bold"),
                           bg=COLORS["sidebar"], fg=COLORS["accent"])
            val.pack(side="right")
            self._stat_labels[key] = val

    def _build_main(self, parent):
        # Header bar
        header = tk.Frame(parent, bg=COLORS["header"], height=64)
        header.pack(fill="x")
        header.pack_propagate(False)

        tk.Label(header, text="My Tasks", font=("Segoe UI", 16, "bold"),
                 bg=COLORS["header"], fg="white").pack(side="left", padx=24, pady=16)

        # Search box
        sf = tk.Frame(header, bg=COLORS["header"])
        sf.pack(side="left", padx=16, pady=12)
        tk.Label(sf, text="ğŸ”", bg=COLORS["header"], fg="#888").pack(side="left")
        se = tk.Entry(sf, textvariable=self._search,
                      font=("Segoe UI", 10), bg="#2A2A3E", fg="white",
                      insertbackground="white", bd=0,
                      highlightthickness=1, highlightbackground="#444",
                      width=22)
        se.pack(side="left", ipady=5, padx=4)

        # Action buttons
        bf = tk.Frame(header, bg=COLORS["header"])
        bf.pack(side="right", padx=16, pady=12)

        for text, cmd, color in [
            ("â• Add Task",    self._add_task,    COLORS["btn_green"]),
            ("âœï¸ Edit",        self._edit_task,   COLORS["btn_blue"]),
            ("âœ… Toggle Done", self._toggle_done, COLORS["btn_yellow"]),
            ("ğŸ—‘ï¸ Delete",      self._delete_task, COLORS["btn_red"]),
        ]:
            tk.Button(bf, text=text, command=cmd,
                      font=("Segoe UI", 9, "bold"),
                      bg=color, fg=COLORS["text_dark"],
                      relief="flat", bd=0, cursor="hand2",
                      padx=12, pady=5).pack(side="left", padx=3)

        # Task table
        table_frame = tk.Frame(parent, bg=COLORS["bg"])
        table_frame.pack(fill="both", expand=True, padx=20, pady=16)

        style = ttk.Style()
        style.theme_use("clam")
        style.configure("Custom.Treeview",
                         font=("Segoe UI", 10),
                         rowheight=34,
                         background=COLORS["row_even"],
                         fieldbackground=COLORS["row_even"],
                         foreground=COLORS["text_dark"],
                         borderwidth=0)
        style.configure("Custom.Treeview.Heading",
                         font=("Segoe UI", 10, "bold"),
                         background=COLORS["header"],
                         foreground="white",
                         borderwidth=0, relief="flat")
        style.map("Custom.Treeview",
                  background=[("selected", COLORS["accent"]),
                               ("!selected", COLORS["row_even"])],
                  foreground=[("selected", "white")])

        cols = ("id", "title", "priority", "due", "status", "created")
        self._tree = ttk.Treeview(table_frame, columns=cols, show="headings",
                                   style="Custom.Treeview", selectmode="browse")

        headers = {"id":"#","title":"Title","priority":"Priority",
                   "due":"Due Date","status":"Status","created":"Created"}
        widths   = {"id":40,"title":320,"priority":90,"due":110,"status":90,"created":120}
        anchors  = {"id":"center","title":"w","priority":"center",
                    "due":"center","status":"center","created":"center"}

        for c in cols:
            self._tree.heading(c, text=headers[c],
                               command=lambda col=c: self._sort_by(col))
            self._tree.column(c, width=widths[c], anchor=anchors[c])

        # Tags for row styling
        self._tree.tag_configure("done",    foreground=COLORS["done_fg"])
        self._tree.tag_configure("overdue", foreground=COLORS["overdue"])
        self._tree.tag_configure("high",    foreground=COLORS["High"])
        self._tree.tag_configure("odd",     background=COLORS["row_odd"])

        scroll = ttk.Scrollbar(table_frame, orient="vertical",
                               command=self._tree.yview)
        self._tree.configure(yscrollcommand=scroll.set)

        self._tree.pack(side="left", fill="both", expand=True)
        scroll.pack(side="right", fill="y")

        self._tree.bind("<Double-1>", lambda e: self._edit_task())
        self._tree.bind("<Delete>",   lambda e: self._delete_task())

        # Status bar
        self._status_var = tk.StringVar(value="Ready")
        status_bar = tk.Label(parent, textvariable=self._status_var,
                              font=("Segoe UI", 9), bg=COLORS["border"],
                              fg="#555", anchor="w", padx=16, pady=4)
        status_bar.pack(fill="x", side="bottom")

    # â”€â”€ Refresh â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    def _refresh(self):
        self._tree.delete(*self._tree.get_children())
        search = self._search.get().lower()
        today  = datetime.now().date()

        visible = []
        for t in self._tasks:
            if self._filter == "Pending"   and t["completed"]:            continue
            if self._filter == "Completed" and not t["completed"]:        continue
            if self._filter in ("High","Medium","Low") and t["priority"] != self._filter: continue
            if search and search not in t["title"].lower() \
                      and search not in t.get("description","").lower():  continue
            visible.append(t)

        for i, t in enumerate(visible):
            status = "âœ… Done" if t["completed"] else "â³ Pending"
            due    = t.get("due_date", "â€”")
            icon   = PRIORITY_ICONS.get(t["priority"], "")
            tags   = []

            if t["completed"]:
                tags.append("done")
            elif due and due != "â€”":
                try:
                    if datetime.strptime(due, "%Y-%m-%d").date() < today:
                        tags.append("overdue")
                except ValueError:
                    pass
            elif t["priority"] == "High":
                tags.append("high")

            if i % 2 == 1:
                tags.append("odd")

            self._tree.insert("", "end", iid=str(t["id"]),
                              values=(t["id"], t["title"],
                                      f"{icon} {t['priority']}",
                                      due, status,
                                      t.get("created_at", "â€”")),
                              tags=tags)

        # Update stats
        total    = len(self._tasks)
        done     = sum(1 for t in self._tasks if t["completed"])
        pending  = total - done
        overdue  = sum(
            1 for t in self._tasks
            if not t["completed"] and t.get("due_date")
            and datetime.strptime(t["due_date"], "%Y-%m-%d").date() < today
        )
        self._stat_labels["Total"].config(text=str(total))
        self._stat_labels["Pending"].config(text=str(pending))
        self._stat_labels["Done"].config(text=str(done))
        self._stat_labels["Overdue"].config(text=str(overdue),
            fg=COLORS["overdue"] if overdue else COLORS["accent"])

        self._status_var.set(
            f"Showing {len(visible)} of {total} tasks  â€¢  Filter: {self._filter}")

        # Highlight active filter button
        for label, btn in self._filter_btns.items():
            if label == self._filter:
                btn.config(bg=COLORS["accent_dark"], fg="white")
            else:
                btn.config(bg=COLORS["sidebar"], fg=COLORS["sidebar_text"])

    # â”€â”€ Actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    def _set_filter(self, label):
        self._filter = label
        self._refresh()

    def _add_task(self):
        dlg = TaskDialog(self)
        self.wait_window(dlg)
        if dlg.result:
            task = {
                "id":         next_id(self._tasks),
                "completed":  False,
                "created_at": datetime.now().strftime("%Y-%m-%d %H:%M"),
                **dlg.result,
            }
            self._tasks.append(task)
            save_tasks(self._tasks)
            self._refresh()
            self._status_var.set(f"âœ… Task '{task['title']}' added.")

    def _edit_task(self):
        sel = self._tree.selection()
        if not sel:
            messagebox.showinfo("Edit", "Please select a task first.")
            return
        tid  = int(sel[0])
        task = next((t for t in self._tasks if t["id"] == tid), None)
        if not task:
            return
        dlg = TaskDialog(self, task)
        self.wait_window(dlg)
        if dlg.result:
            task.update(dlg.result)
            save_tasks(self._tasks)
            self._refresh()
            self._status_var.set(f"âœï¸ Task '{task['title']}' updated.")

    def _toggle_done(self):
        sel = self._tree.selection()
        if not sel:
            messagebox.showinfo("Toggle", "Please select a task first.")
            return
        tid  = int(sel[0])
        task = next((t for t in self._tasks if t["id"] == tid), None)
        if task:
            task["completed"] = not task["completed"]
            save_tasks(self._tasks)
            self._refresh()
            status = "completed âœ…" if task["completed"] else "pending â³"
            self._status_var.set(f"Task '{task['title']}' marked as {status}.")

    def _delete_task(self):
        sel = self._tree.selection()
        if not sel:
            messagebox.showinfo("Delete", "Please select a task first.")
            return
        tid  = int(sel[0])
        task = next((t for t in self._tasks if t["id"] == tid), None)
        if not task:
            return
        if messagebox.askyesno("Delete Task",
                               f"Delete '{task['title']}'?\nThis cannot be undone.",
                               icon="warning"):
            self._tasks.remove(task)
            save_tasks(self._tasks)
            self._refresh()
            self._status_var.set(f"ğŸ—‘ï¸ Task deleted.")

    def _sort_by(self, col):
        items = [(self._tree.set(k, col), k) for k in self._tree.get_children("")]
        items.sort()
        for index, (_, k) in enumerate(items):
            self._tree.move(k, "", index)


# â”€â”€ Entry point â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if __name__ == "__main__":
    app = TaskManagerApp()
    app.mainloop()